syntax = "proto3";

package loader;

option go_package = "github.com/accretional/runrpc/loader";

// Loader service handles loading of binaries
service Loader {
    // Load validates and prepares a binary for execution
    // Exec implements execve(const char *pathname, char *const argv[], char *const envp[]):
    rpc Exec(ExecutionArgs) returns (ExitCode);
    // Link is like ~dlopen but in a way that allows for deferred Loading
    rpc Link(stream BytesValue) returns (LoadHandle);
    // Load implements fexecve
    rpc Load(LoadArgs) returns (ExitCode);
}

message ExecutionArgs {
    string path = 1;
    repeated string args = 2;
    map<string, string> env = 3;
}

message LoadArgs {
    int fd = 1;
    repeated string args = 2;
    map<string, string> env = 3;
}

message ExitCode {
    int code = 1;
}

message LoadHandle {
    int fd = 1;
}